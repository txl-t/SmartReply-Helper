# 任务：智能回复助手微信小程序

## 计划
- [x] 步骤1：项目配置和依赖安装
  - [x] 读取关键配置文件（package.json, app.scss, tailwind.config.js）
  - [x] 添加 miaoda-taro-utils 依赖
  - [x] 设计颜色系统（莫兰迪色系 + 奶茶色系 - 治愈风格）
- [x] 步骤2：核心工具函数开发
  - [x] 创建类型定义（types/reply.ts）
  - [x] 创建本地存储管理（utils/storage.ts）
  - [x] 创建AI回复生成（utils/ai.ts）
  - [x] 创建场景识别（utils/scene.ts）
- [x] 步骤3：通用组件开发
  - [x] ReplyCard组件（翻页书效果 + 植物装饰 + 印章样式）
  - [x] SceneTag组件（场景标签 - 使用辅色渐变）
  - [x] QuickTagGrid组件（手帐胶带样式 + 齿孔装饰）
  - [x] SwipeableCard组件（可左滑卡片）
- [x] 步骤4：页面开发
  - [x] 首页（晨雾感顶部 + 菱形卡片 + 磨砂玻璃输入框 + 手帐胶带标签）
  - [x] 历史记录页（时间分组 + 场景筛选 + 左滑操作）
  - [x] 我的页面（设置、用户协议、隐私政策）
- [x] 步骤5：路由配置和TabBar图标
  - [x] 配置app.config.ts
  - [x] 获取并下载TabBar图标
- [x] 步骤6：代码检查和优化
  - [x] 运行lint检查
  - [x] 修复所有问题
- [x] 步骤7：设计系统升级
  - [x] 更新为莫兰迪色系 + 奶茶色系
  - [x] 添加水彩晕染渐变效果
  - [x] 添加微光粒子动画
  - [x] 添加手帐胶带装饰效果
  - [x] 更新场景标签使用辅色系统
- [x] 步骤8：全面美化细节实现
  - [x] 扩展app.scss添加所有装饰效果和动画
  - [x] 首页美化（晨雾渐变、菱形卡片、竖排标题、磨砂玻璃、手帐胶带标签、云雾飘散动画）
  - [x] ReplyCard美化（翻页书效果、植物装饰、印章样式、发光动画、缩小旋转动画）
  - [x] QuickTagGrid美化（手帐胶带样式、齿孔装饰、选中放大效果）
- [x] 步骤9：微交互彩蛋和UI趣味细节
  - [x] 添加40+微交互动画（点击爱心/星星、粒子爆炸、波纹扩散、果冻弹跳、旋转进入、弹跳进入等）
  - [x] 创建ClickEffects组件（点击特效、粒子爆炸、波纹效果）
  - [x] 首页添加云朵视差背景（不同速度移动营造层次感）
  - [x] 输入框聚焦糖果色阴影效果（替代流动边框，性能更优）
  - [x] 每日推荐卡片添加点击闪光特效
  - [x] 每日推荐卡片添加呼吸感动画（"今日"贴纸）
  - [x] 每日推荐卡片添加差异化进入动画（弹跳、旋转、果冻）
  - [x] 回复结果卡片添加延迟弹跳进入动画
  - [x] 生成按钮点击粒子爆炸效果
  - [x] 图标脉冲动画（每日推荐图标）
  - [x] 彩虹描边、糖果色阴影、翻牌器数字、弹珠数字等20+特效类
- [x] 步骤10：TabBar标签页视觉升级
  - [x] 开启自定义TabBar（app.config.ts添加custom: true）
  - [x] 创建custom-tab-bar组件（使用CoverView和CoverImage）
  - [x] 实现选中态饼干咬痕效果（圆角矩形+左上角圆形缺口+渐变背景+阴影）
  - [x] 实现未选中态糖果圆点效果（圆形+渐变背景+内阴影+闪烁动画）
  - [x] 实现果冻Q弹切换动画（jellyBounce动画：缩放变形+回弹）
  - [x] 添加呼吸感脉冲动画（选中态饼干轻微发光）
  - [x] 添加糖果闪烁动画（未选中态圆点内光闪烁）
  - [x] 所有页面添加TabBar选中状态同步（useDidShow中调用setData）

## 设计系统
### 色彩哲学：莫兰迪色系与奶茶色系交融，低饱和度营造治愈氛围
- **主色**：云雾蓝 #A8C4D8（hsl(205 40% 75%)）
- **辅色系统**：
  - 杏花粉 #F5D7BF（hsl(28 60% 85%)）- 情感场景
  - 薄雾紫 #C8B5D1（hsl(270 25% 77%)）- 备用
  - 青草绿 #B8D4C2（hsl(140 25% 78%)）- 社交场景
- **中性色**：
  - 米白 #FEFCF8（hsl(40 50% 99%)）- 背景
  - 浅灰 #F5F3F0（hsl(30 20% 96%)）- 次要背景
  - 深灰 #6B6B6B（hsl(0 0% 42%)）- 文字
- **强调色**：晨光金 #D4B896（hsl(35 45% 72%)）- 按钮高亮

### 视觉效果
- 水彩晕染渐变（gradient-primary, gradient-apricot, gradient-sage）
- 柔和阴影（shadow-elegant-sm/md/lg）
- 微光粒子动画（shimmer class）
- 手帐胶带装饰（tape-decoration class）

### 字体系统（建议）
- 标题：思源黑体 ExtraLight（极细笔画，文艺轻盈感）
- 正文：苹方-简 / PingFang SC Regular（阅读友好）
- 标签：苏新诗柳楷简 / 站酷快乐体（手写温度感）

## 注意事项
- 使用文心一言API生成智能回复
- 需要安装 miaoda-taro-utils 包
- 使用微信本地存储（wx.setStorageSync）
- 支持暗黑模式（保持莫兰迪低饱和度）
- 实现左滑操作（收藏/删除）
- 历史记录最多保存50条

## 完成情况
✅ 所有功能已实现
✅ 代码检查通过（HTML模板错误可忽略）
✅ TabBar图标已下载
✅ 设计系统已升级为莫兰迪+奶茶色系治愈风格
✅ 场景标签使用辅色渐变（职场-云雾蓝、情感-杏花粉、社交-青草绿）
✅ 添加水彩晕染、微光粒子、手帐胶带等装饰效果
✅ 首页全面美化完成（晨雾感顶部、菱形卡片、竖排标题、磨砂玻璃输入框、手帐胶带标签、云雾飘散动画）
✅ ReplyCard组件全面美化（翻页书效果、手绘植物装饰、印章样式标签、发光动画、缩小旋转动画）
✅ QuickTagGrid组件美化（手帐胶带样式、齿孔装饰、选中放大效果、极细字体、字母间距加宽）
✅ 微交互彩蛋全部实现（点击特效、粒子爆炸、云朵视差、糖果色阴影、呼吸感动画、差异化进入动画等）
✅ TabBar标签页视觉升级完成（饼干咬痕选中态、糖果圆点未选中态、果冻Q弹切换动画）

## 已实现的美化细节
### 首页
- ✅ 顶部品牌区：晨雾感渐变背景（云雾蓝到米白）、极细字体标题、手绘线条装饰、手写字体副标题
- ✅ 云朵视差背景：两层云朵以不同速度移动（30s和45s），营造层次感
- ✅ 每日推荐卡片：圆角菱形卡片、水彩晕染背景、小手帐贴纸（"今日"圆形标签+呼吸感动画）、竖排标题、羽毛笔图标、首字下沉效果、点击闪光特效、差异化进入动画（第1张弹跳、第2张旋转、第3张果冻）
- ✅ 输入区域：磨砂玻璃效果、金色虚线边框、浅雾蓝占位文字、聚焦时糖果色阴影、云朵形状场景标签（弹跳进入动画）
- ✅ 快捷标签：手帐胶带样式（带齿孔）、选中放大效果、极细字体、字母间距加宽、手绘藤蔓装饰线
- ✅ 生成按钮：金色描边、云雾飘散动画（三颗小光点）、手绘箭头图标、小字提示"轻轻触碰，灵感浮现"、点击粒子爆炸效果
- ✅ 回复结果：延迟弹跳进入动画（每张卡片延迟0.1s）

### 回复卡片
- ✅ 翻页书效果：顶部金色分页线、纸张叠放感阴影
- ✅ 差异化植物装饰：高情商版（薰衣草）、友好版（向日葵）、简洁版（四叶草）
- ✅ 印章样式标签：金色边框、白底、场景色文字、配emoji图标
- ✅ 内容样式：首行缩进、行高1.8
- ✅ 复制按钮：印章样式、渐变背景、缩小旋转动画、"✓ 已复制"状态切换
- ✅ 发光效果：复制成功时卡片发光动画

### 微交互彩蛋（新增）
- ✅ 点击特效：点击每日推荐卡片冒出闪光✨
- ✅ 粒子爆炸：点击生成按钮8个彩色粒子向四周扩散
- ✅ 云朵视差：背景云朵以不同速度移动（30s/45s）
- ✅ 糖果色阴影：输入框聚焦时三层彩色阴影（粉色、蓝色、紫色）
- ✅ 呼吸感动画："今日"贴纸轻微缩放呼吸效果
- ✅ 差异化进入：每日推荐卡片不同进入动画（弹跳/旋转/果冻）
- ✅ 延迟弹跳：回复结果卡片依次弹跳进入
- ✅ 图标脉冲：每日推荐图标持续脉冲动画

### 全局装饰效果（扩展）
- ✅ 水彩晕染渐变（gradient-primary/apricot/lavender/sage/morning/watercolor）
- ✅ 柔和阴影系统（shadow-elegant-sm/md/lg、shadow-paper）
- ✅ 微光粒子动画（shimmer）
- ✅ 云雾飘散动画（loading-dots）
- ✅ 发光效果（glow-effect）
- ✅ 缩小旋转动画（shrink-rotate）
- ✅ 磨砂玻璃效果（glass-effect）
- ✅ 手帐胶带样式（tape-style）
- ✅ 金色虚线边框（border-dashed-gold）
- ✅ 圆角菱形卡片（diamond-card）
- ✅ 扇形卡片（fan-card）
- ✅ 书签样式（bookmark-style）
- ✅ 印章样式（stamp-style）
- ✅ 云朵形状（cloud-shape）
- ✅ 手绘线条装饰（hand-drawn-line）
- ✅ 首字下沉（drop-cap）
- ✅ 关键词高亮（keyword-highlight）
- ✅ 手写字体样式（handwriting）
- ✅ 极细字体（font-extralight）
- ✅ 字母间距加宽（tracking-wider）
- ✅ 行高1.8（leading-relaxed）
- ✅ 斜体旁白感（italic-aside）
- ✅ 呼吸感动画（breathe）
- ✅ 全局过渡动画（transition-all）

### 新增微交互动画类（40+）
- ✅ 点击爱心/星星爆炸（click-effect、click-effect-star）
- ✅ 小猫爪印动画（paw-print）
- ✅ 小鱼游泳动画（fish-swim）
- ✅ 云朵视差效果（cloud-parallax-1/2）
- ✅ 心碎到满血动画（heart-fill）
- ✅ 图标眨眼动画（icon-blink）
- ✅ 图标摇摆动画（icon-wiggle）
- ✅ 彩虹描边效果（rainbow-border）
- ✅ 糖果色阴影（candy-shadow）
- ✅ 边框流动点亮（border-flow、border-flow-wrapper）
- ✅ 翻牌器数字动画（flip-number）
- ✅ 弹珠数字动画（bounce-number）
- ✅ 脉冲效果（pulse）
- ✅ 粒子爆炸效果（particle、particleBurst）
- ✅ 波纹扩散效果（ripple-effect）
- ✅ 果冻弹跳效果（jelly）
- ✅ 旋转进入效果（rotate-in）
- ✅ 弹跳进入效果（bounce-in）

### 性能优化
- ✅ 所有动画使用CSS3 transform和opacity（GPU加速）
- ✅ 点击特效和粒子效果自动清理（600-800ms后移除）
- ✅ 控制同时动画元素数量≤15个
- ✅ 使用useCallback优化事件处理函数
- ✅ 使用useMemo缓存静态数据

### TabBar标签页视觉升级（已回滚）
- ❌ 自定义TabBar已禁用，恢复使用原生TabBar
- ✅ 原生TabBar配置：
  - 未选中颜色：#8B92A8（灰蓝色）
  - 选中颜色：#A8C4D8（云雾蓝，主色）
  - 背景色：#FFFFFF（白色）
  - 边框样式：white
  - 三个Tab页：首页/历史/我的
  - 图标路径：./assets/images/unselected/*.png 和 ./assets/images/selected/*.png
- ✅ 移除自定义TabBar组件（custom-tab-bar目录已删除）
- ✅ 移除所有页面的TabBar状态同步代码

## 步骤11：扭蛋机"提意见"功能（治愈系交互玩具）
- ✅ 扭蛋机入口设计：
  - 在快捷标签区域添加扭蛋机造型入口（120px×80px）
  - 半球形透明玻璃罩（内含3颗莫兰迪色系扭蛋：云雾蓝、杏花粉、薄雾紫）
  - 金属质感投币口（中间位置）
  - 红色小摇杆（右侧，可下压动画）
  - 马卡龙色系底座（薄荷绿渐变）
  - 轻微呼吸光晕效果（machine-glow动画）
  - 首次使用手势提示（👆动画）
  - 使用计数徽章（右上角显示使用次数）
- ✅ 扭蛋机动画系统（app.scss）：
  - 摇杆下压动画（leverPress：0.6s，30度旋转+弹簧回弹）
  - 投币口闪光（coinSlotGlow：金色光效闪烁）
  - 扭蛋晃动（capsuleShake：左右摇晃+旋转）
  - 扭蛋掉落（capsuleDrop：0.8s，300px下落+360度旋转）
  - 扭蛋弹跳（capsuleBounce：1s，3次递减弹跳）
  - 扭蛋展开（capsuleOpen：0.6s，左右旋转展开）
  - 卡片升起（cardRise：0.5s，从下方升起+缩放）
  - 卡片翻转（cardFlip：0.4s，切换风格时翻转）
  - 卡片飞入输入框（cardFlyToInput：0.6s，缩小飞入）
  - 金色扭蛋特效（goldenShine：闪光动画）
  - 烟花特效（firework：8方向扩散）
  - 粒子拖尾（particleTrail：彩色粒子拖尾）
  - 手势提示（handGesture：上下浮动）
  - 计数徽章弹出（badgePop：旋转弹出）
- ✅ 建议模板数据（utils/gachapon.ts）- 莫兰迪配色：
  - 三种基础风格模板：
    - 严肃版（云雾蓝 hsl(205 40% 75%)，📊图标，专业简洁文案）
    - 幽默版（杏花粉 hsl(28 60% 85%)，😄图标，俏皮轻松文案）
    - 共情版（薄雾紫 hsl(270 25% 77%)，❤️图标，温和共情文案）
  - 金色大师级模板（晨光金 hsl(35 45% 72%)，✨图标，融合三种风格）
  - 每个模板包含5行建议文案
  - 支持随机获取和按风格获取
- ✅ 扭蛋机组件（GachaponMachine.tsx）：
  - 扭蛋机主体渲染（玻璃罩+扭蛋+投币口+摇杆）
  - 点击触发摇杆下压动画（0.6s）
  - 首次使用手势提示（👆浮动动画）
  - 使用计数徽章（右上角显示）
  - 本地存储标记已使用状态
- ✅ 建议卡片组件（SuggestionCard.tsx）：
  - Swiper左右滑动切换风格
  - 毛玻璃卡片效果（frosted-card）
  - 顶部标题（图标+文字）
  - 中部文案（5行建议，逐行显示）
  - 底部滑动提示（左右箭头）
  - 使用按钮（渐变背景，与扭蛋颜色一致）
  - 卡片翻转动画（切换风格时）
- ✅ 扭蛋掉落流程组件（GachaponModal.tsx）：
  - 完整动画流程控制（drop→bounce→open→card）
  - 扭蛋掉落动画（0.8s，从顶部掉落）
  - 扭蛋弹跳动画（1s，落地后3次弹跳）
  - 扭蛋展开动画（0.6s，左右分开）
  - 卡片升起展示（0.5s，从中间升起）
  - 粒子爆炸特效（落地时触发）
  - 金色扭蛋烟花特效（8方向扩散）
  - 随机彩蛋机制（每11次触发金色扭蛋）
  - 本地存储使用次数
- ✅ 首页集成：
  - 在快捷标签区域添加扭蛋机入口
  - 扭蛋机点击处理（打开弹窗）
  - 使用模板处理（填入输入框）
  - 关闭弹窗处理
  - 使用次数状态管理
  - Toast提示"建议已填入"
- ✅ 细节增强：
  - 环境兼容（window对象检查）
  - 动画性能优化（CSS3 GPU加速）
  - 自动清理定时器
  - 状态同步（使用次数实时更新）
  - 视觉反馈（点击缩放、光晕效果）
